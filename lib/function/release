#!/bin/bash

sources_list (){
SOURCES_LIST="${P_VALUE}/etc/apt/sources.list.d/${DISTRO}.sources"
}

mirrors (){
source mirror.txt
if [[ "$DISTRO" == "debian" ]]; then MIRROR="${DEBIAN_MIRROR}"
elif [[ "$DISTRO" == "devuan" ]]; then MIRROR="${DEVUAN_MIRROR}"
elif [[ "$DISTRO" == "kali" ]]; then MIRROR="${KALI_MIRROR}"
elif [[ "$DISTRO" == "ubuntu" ]]; then MIRROR="${UBUNTU_MIRROR}"; fi
}

# DEBIAN
debian_release (){
POOL="main contrib non-free non-free-firmware"
if [[ "$DISTRO_VERSION" =~ ^(bookworm|trixie|testing)$ ]]; then
	tee ${SOURCES_LIST} <<EOF
Types: deb
URIs: ${MIRROR}
Suites: ${DISTRO_VERSION} ${DISTRO_VERSION}-updates ${DISTRO_VERSION}-proposed-updates ${DISTRO_VERSION}-backports
Components: ${POOL}
Enabled: yes
Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg

Types: deb
URIs: ${MIRROR}-security
Suites: ${DISTRO_VERSION}-security
Components: ${POOL}
Enabled: yes
Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg
EOF
else
	tee ${SOURCES_LIST} <<EOF
Types: deb
URIs: ${MIRROR}
Suites: ${DISTRO_VERSION}
Components: ${POOL}
Enabled: yes
Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg
EOF
fi
}

# DEVUAN
devuan_release (){
POOL="main contrib non-free non-free-firmware"
if [[ "$DISTRO_VERSION" =~ ^(daedalus|excalibur)$ ]]; then
	tee ${SOURCES_LIST} <<EOF
Types: deb
URIs: ${MIRROR}
Suites: ${DISTRO_VERSION} ${DISTRO_VERSION}-updates ${DISTRO_VERSION}-proposed-updates ${DISTRO_VERSION}-backports
Components: ${POOL}
Enabled: yes
Signed-By: /usr/share/keyrings/devuan-archive-keyring.gpg

Types: deb
URIs: ${MIRROR}
Suites: ${DISTRO_VERSION}-security
Components: ${POOL}
Enabled: yes
Signed-By: /usr/share/keyrings/devuan-archive-keyring.gpg
EOF
else
	tee ${SOURCES_LIST} <<EOF
Types: deb
URIs: ${MIRROR}
Suites: ${DISTRO_VERSION}
Components: ${POOL}
Enabled: yes
Signed-By: /usr/share/keyrings/devuan-archive-keyring.gpg
EOF
fi
}

# KALI
kali_release (){
# https://www.kali.org/docs/general-use/kali-linux-sources-list-repositories/
POOL="main contrib non-free non-free-firmware"
tee ${SOURCES_LIST} <<EOF
Types: deb
URIs: ${MIRROR}
Suites: ${DISTRO_VERSION}
Components: ${POOL}
Enabled: yes
Signed-By: /usr/share/keyrings/kali-archive-keyring.gpg
EOF
}

# UBUNTU
ubuntu_release (){
tee ${SOURCES_LIST} <<EOF
Types: deb
URIs: ${MIRROR}
Suites: ${DISTRO_VERSION} ${DISTRO_VERSION}-updates ${DISTRO_VERSION}-backports
Components: main restricted universe multiverse
Enabled: yes
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

Types: deb
URIs: ${MIRROR}
Suites: ${DISTRO_VERSION}-security
Components: main restricted universe multiverse
Enabled: yes
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
EOF
}

choose_release (){
if [[ "$DISTRO" =~ ^(debian|devuan|kali|ubuntu)$ ]]; then
	${DISTRO}_release
else
	echo "${CAP_DISTRO} ${CAP_RELEASE} is not supported."
	exit 1
fi
}
